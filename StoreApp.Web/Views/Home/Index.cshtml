@model ProductListViewModel

<div class="position-relative mb-5 my-4">
    <div id="mainBannerCarousel" class="carousel slide carousel-fade" data-bs-ride="carousel">
        <div class="carousel-inner rounded-4 shadow overflow-hidden">

            @for (int i = 0; i < Model.Slides.Count(); i++)
            {
                var slide = Model.Slides.ElementAt(i);
                var isActive = i == 0 ? "active" : "";

                <div class="carousel-item @isActive">
                    <a href="@slide.Link">
                        <div style="aspect-ratio: 16/5; height: auto; overflow: hidden;">
                            <img src="~/img/slides/@slide.ImageUrl" class="d-block w-100"
                                style="width: 100%; height: 100%; object-fit: cover;" alt="@slide.Title" />
                        </div>

                    </a>
                </div>
            }
        </div>

        <div class="carousel-indicators mt-4">
            @for (int i = 0; i < Model.Slides.Count(); i++)
            {
                var isActive = i == 0 ? "active" : "";
                var ariaCurrent = i == 0 ? "true" : "false";

                <button type="button" data-bs-target="#mainBannerCarousel" data-bs-slide-to="@i" class="@isActive"
                    aria-current="@ariaCurrent" aria-label="Slide @(i + 1)"
                    style="width: 12px; height: 12px; border-radius: 50%; background-color: #333;">
                </button>
            }
        </div>
    </div>

    <button class="carousel-control-prev position-absolute top-50 start-0 translate-middle-y" type="button"
        data-bs-target="#mainBannerCarousel" data-bs-slide="prev" style="z-index: 2;">
        <span class="carousel-control-prev-icon bg-dark bg-opacity-75 rounded-circle p-3 shadow"
            aria-hidden="true"></span>
        <span class="visually-hidden">Önceki</span>
    </button>
    <button class="carousel-control-next position-absolute top-50 end-0 translate-middle-y" type="button"
        data-bs-target="#mainBannerCarousel" data-bs-slide="next" style="z-index: 2;">
        <span class="carousel-control-next-icon bg-dark bg-opacity-75 rounded-circle p-3 shadow"
            aria-hidden="true"></span>
        <span class="visually-hidden">Sonraki</span>
    </button>
</div>




<hr>


@if (Model.FeaturedProducts?.Any() == true)
{
    <div class="container my-5 position-relative">
        <h4 class="fw-bold mb-3">Günün Öne Çıkanları</h4>

        <div id="featuredContainer" class="d-flex overflow-hidden gap-3">
           @foreach (var p in Model.FeaturedProducts)
{
    var isFavorited = Model.FavoriteProductIds?.Contains(p.Id) == true;

    <div class="card h-100 border rounded shadow-sm position-relative"
         style="min-width: 250px; max-width: 250px; flex: 0 0 auto;">
                         @if (User.Identity.IsAuthenticated){
        <button type="button"
                class="btn btn-light border rounded-circle position-absolute top-0 end-0 m-2 shadow-sm favorite-btn"
                onclick="toggleFavorite(@p.Id, this)">
            <i class="bi @(isFavorited ? "bi-heart-fill text-danger" : "bi-heart")"></i>
        </button>
        }
        <a href="/products/@p.Url" class="text-decoration-none text-dark d-block">

            <div class="position-absolute top-0 start-0 m-2 d-flex flex-column gap-1">
                @if (p.IsFeatured)
                {
                    <span class="badge rounded-pill bg-danger">
                        <i class="bi bi-fire me-1"></i> Öne Çıkan
                    </span>
                }
            </div>

            <img src="~/img/products/@p.Image" class="card-img-top p-2" alt="@p.Name"
                 style="height: 180px; object-fit: contain;" />

            <div class="card-body text-center">
                <div class="mb-1 text-warning">
                    <i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i>
                    <i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i>
                    <i class="bi bi-star-half"></i>
                    <small class="text-muted">(12)</small>
                </div>
                <h6 class="card-title text-truncate">@p.Name</h6>
                <h5 class="text-danger fw-bold">@p.Price ₺</h5>
                <p class="text-success mb-0" style="font-size: 0.9rem;">
                    KDV dahil ücretsiz kargo
                </p>
            </div>
        </a>
    </div>
}

        </div>

        <button onclick="scrollFeatured(-1)"
            class="btn btn-light position-absolute top-50 start-0 translate-middle-y shadow-sm" style="z-index: 2;">
            <i class="bi bi-chevron-left fs-4"></i>
        </button>
        <button onclick="scrollFeatured(1)"
            class="btn btn-light position-absolute top-50 end-0 translate-middle-y shadow-sm" style="z-index: 2;">
            <i class="bi bi-chevron-right fs-4"></i>
        </button>
    </div>
}




@if (Model.Campaigns?.Any(c => c.IsActive) == true)

{
    <div class="container my-5 position-relative">
        <h4 class="fw-bold mb-3">Kampanyalar</h4>

        <div id="campaignContainer" class="d-flex overflow-hidden gap-4" style="scroll-behavior: smooth;">
            @foreach (var c in Model.Campaigns.Where(c => c.IsActive).Concat(Model.Campaigns.Where(c => c.IsActive)))
            {
                <div class="card h-100 border rounded shadow-sm"
                    style="min-width: calc(100% / 3.2); max-width: calc(100% / 3.2); flex: 0 0 auto;">
                    <img src="~/img/campain/@c.Image" class="card-img-top" alt="@c.Title"
                        style="width: 100%; height: 180px; object-fit: cover;">
                    <div class="card-body">
                        <p class="card-text text-muted mb-1">@c.SubTitle</p>
                        <h5 class="fw-bold">@c.Title</h5>
                        <a href="/campaign/@c.Url" class="btn btn-outline-dark mt-3">
                            <i class="bi bi-arrow-right"></i> Alışverişe Başla
                        </a>
                    </div>
                </div>
            }
        </div>

        <button onclick="scrollCampaigns(-1)"
            class="btn btn-light position-absolute top-50 start-0 translate-middle-y shadow-sm" style="z-index: 2;">
            <i class="bi bi-chevron-left fs-4"></i>
        </button>
        <button onclick="scrollCampaigns(1)"
            class="btn btn-light position-absolute top-50 end-0 translate-middle-y shadow-sm" style="z-index: 2;">
            <i class="bi bi-chevron-right fs-4"></i>
        </button>
    </div>
}
<hr>

@if (Model.BestSellerProducts?.Any() == true)
{
    <div class="container my-5 position-relative">
        <h4 class="fw-bold mb-3">Çok Satanlar</h4>

        <div id="bestSellerContainer" class="d-flex overflow-hidden gap-3">
            @foreach (var p in Model.BestSellerProducts)
            {
                var isFavorited = Model.FavoriteProductIds?.Contains(p.Id) == true;

                <div class="card h-100 border rounded shadow-sm position-relative"
                     style="min-width: 250px; max-width: 250px; flex: 0 0 auto;">
                                             @if (User.Identity.IsAuthenticated){

                    <button type="button"
                            class="btn btn-light border rounded-circle position-absolute top-0 end-0 m-2 shadow-sm favorite-btn"
                            onclick="toggleFavorite(@p.Id, this)">
                        <i class="bi @(isFavorited ? "bi-heart-fill text-danger" : "bi-heart")"></i>
                    </button>
                    }

                    <a href="/products/@p.Url" class="text-decoration-none text-dark">
                        <div class="position-absolute top-0 start-0 m-2 d-flex flex-column gap-1">
                            @if (p.IsBestSeller)
                            {
                                <span class="badge rounded-pill bg-warning text-dark">
                                    <i class="bi bi-star-fill me-1"></i> Çok Satan
                                </span>
                            }
                        </div>

                        <img src="~/img/products/@p.Image" class="card-img-top p-2" alt="@p.Name"
                             style="height: 180px; object-fit: contain;" />

                        <div class="card-body text-center">
                            <h6 class="card-title text-truncate">@p.Name</h6>
                            <h5 class="text-danger fw-bold">@p.Price ₺</h5>
                            <p class="text-success mb-0" style="font-size: 0.9rem;">
                                KDV dahil ücretsiz kargo
                            </p>
                        </div>
                    </a>
                </div>
            }
        </div>

        <button onclick="scrollBestSellers(-1)"
                class="btn btn-light position-absolute top-50 start-0 translate-middle-y shadow-sm" style="z-index: 2;">
            <i class="bi bi-chevron-left fs-4"></i>
        </button>
        <button onclick="scrollBestSellers(1)"
                class="btn btn-light position-absolute top-50 end-0 translate-middle-y shadow-sm" style="z-index: 2;">
            <i class="bi bi-chevron-right fs-4"></i>
        </button>
    </div>
}

<hr>


<section class="features-section my-5">
    <h5 class="fw-bold mb-4 text-center">Ayrıcalıklarımız</h5>
    <div class="container">
        <div class="row text-center justify-content-center g-4">

            <div class="col-6 col-sm-4 col-md-2">
                <i class="bi bi-truck fs-1 text-danger mb-2"></i>
                <div class="fw-medium">Ücretsiz Kargo</div>
                <small class="text-muted">Her siparişe özel</small>
            </div>

            <div class="col-6 col-sm-4 col-md-2">
                <i class="bi bi-arrow-repeat fs-1 text-danger mb-2"></i>
                <div class="fw-medium">Kolay İade</div>
                <small class="text-muted">14 gün içinde iade garantisi</small>
            </div>

            <div class="col-6 col-sm-4 col-md-2">
                <i class="bi bi-credit-card-2-back fs-1 text-danger mb-2"></i>
                <div class="fw-medium">Taksitli Ödeme</div>
                <small class="text-muted">Kredi kartına 12 aya varan taksit</small>
            </div>

            <div class="col-6 col-sm-4 col-md-2">
                <i class="bi bi-gift fs-1 text-danger mb-2"></i>
                <div class="fw-medium">Hediye Fırsatları</div>
                <small class="text-muted">Kampanya dönemlerinde sürprizler</small>
            </div>

            <div class="col-6 col-sm-4 col-md-2">
                <i class="bi bi-shield-lock fs-1 text-danger mb-2"></i>
                <div class="fw-medium">Güvenli Alışveriş</div>
                <small class="text-muted">SSL sertifikalı ödeme</small>
            </div>
        </div>
</section>




<script>
    window.addEventListener("beforeunload", () => {
        localStorage.setItem("scrollPos", window.scrollY);
    });

    window.addEventListener("load", () => {
        const scrollPos = localStorage.getItem("scrollPos");
        if (scrollPos) {
            window.scrollTo(0, parseInt(scrollPos));
            localStorage.removeItem("scrollPos");
        }
    });

    function scrollHorizontally(containerId, direction) {
        const container = document.getElementById(containerId);
        const scrollAmount = 600;
        const step = 10;
        const delay = 5;
        let scrolled = 0;

        const maxScrollLeft = container.scrollWidth - container.clientWidth;

        const smoothScroll = setInterval(() => {
            container.scrollLeft += direction * step;
            scrolled += step;

            if (scrolled >= scrollAmount) {
                clearInterval(smoothScroll);

                if (container.scrollLeft >= maxScrollLeft && direction === 1) {
                    container.scrollLeft = 0;
                } else if (container.scrollLeft <= 0 && direction === -1) {
                    container.scrollLeft = maxScrollLeft;
                }
            }
        }, delay);
    }

    function scrollBestSellers(direction) {
        scrollHorizontally("bestSellerContainer", direction);
    }

    function scrollFeatured(direction) {
        scrollHorizontally("featuredContainer", direction);
    }

    function scrollCampaigns(direction) {
        scrollHorizontally("campaignContainer", direction);
    }

function toggleFavorite(productId, btn) {
    fetch('/Account/ToggleFavorite', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ productId: productId })
    })
    .then(res => {
        if (!res.ok) throw new Error("Sunucu hatası");
        return res.json();
    })
    .then(data => {
        const icon = btn.querySelector('i');
        if (data.favorited) {
            icon.classList.remove('bi-heart');
            icon.classList.add('bi-heart-fill', 'text-danger');
        } else {
            icon.classList.remove('bi-heart-fill', 'text-danger');
            icon.classList.add('bi-heart');
        }
    })
    .catch(error => {
        console.error("Hata:", error);
        alert("Favori işlemi sırasında hata oluştu.");
    });
}

</script>
